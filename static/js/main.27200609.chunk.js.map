{"version":3,"sources":["lib/video.tsx","actions.ts","reducer.ts","store.ts","components/Participation.tsx","components/AudienceItem.tsx","components/AudienceList.tsx","components/MapPanel.tsx","components/pin_leg.png","components/Pointing.png","components/Pointing.tsx","components/Presenter.tsx","components/AudioMuting.svg","components/AudioMutingDisabled.svg","components/AudioMuting.tsx","components/CameraMuting.svg","components/CameraMutingDisabled.svg","components/CameraMuting.tsx","components/MapMuting.svg","components/MapMutingDisabled.svg","components/MapMuting.tsx","components/CameraSwitching.svg","components/CameraSwitching.tsx","components/ToolItem.tsx","components/ToolList.tsx","components/Room.tsx","components/App.tsx","index.tsx"],"names":["currentIndex","currentStream","getDevices","a","navigator","mediaDevices","enumerateDevices","devices","filter","device","kind","nextVideoStream","getTracks","forEach","track","stop","nextIndex","length","nextDevice","deviceId","exact","getUserMedia","audio","video","actionCreator","actionCreatorFactory","AddPeerAction","AddPointingAction","async","ParticipateAction","RemovePeerAction","RemovePointingAction","SelectPeerAction","SetPointintAcrion","SetTransformAcrion","SwitchCameraAction","ToggleAudioMutingAction","ToggleCameraMutingAction","ToggleMapMutingAction","InitializeMapAction","OnMapLocationChangedAction","OnPeerSelectedAction","OnTransformChangedAction","pointingTimerMap","Map","addPointing","peerId","x","y","dispatch","params","started","clearTimeout","get","timerId","setTimeout","set","done","result","error","failed","toggleMapMuting","getState","state","isEnabled","isMapEnabled","InitializeMap","key","defaultZoom","Promise","resolve","geolocation","getCurrentPosition","pos","lat","coords","latitude","lng","longitude","watchPosition","presenter","localPeer","id","room","send","type","onStream","store","stream","onData","data","scale","initialState","audiences","isAudioEnabled","isCameraEnabled","pointings","transform","reducer","reducerWithInitialState","case","audience","_selectedPeerId","Object","assign","p","find","localStream","map","createStore","combineReducers","applyMiddleware","thunk","Participation","props","_onClick","bind","url","URL","document","searchParams","mapkey","network","this","participate","setState","isParticipating","className","onClick","disabled","React","PureComponent","connect","roomId","r","peer","Peer","on","joinRoom","mode","AudienceItem","_videoRef","createRef","selectPeer","current","srcObject","playsInline","play","_updateVideo","isMuted","isSelected","muted","ref","AudienceList","AnyReactComponent","pinImage","src","alt","MapPanel","bootstrapURLKeys","center","Pointing","angle","radian","Math","PI","styles","left","top","transformOrigin","videoStyles","style","logo","Presenter","_panStopTimer","_onPanningStop","_onZoomChange","closest","test","userAgent","toLowerCase","e","target","layerX","layerY","clientWidth","clientHeight","setPointing","window","match","translate","translateMatch","positionX","parseFloat","positionY","area","_getVideoArea","setTransform","offsetLeft","offsetTop","atan2","addEventListener","prevProps","_amIPresenter","settings","_isMobile","onPanningStop","onZoomChange","pan","onPanning","doubleClick","_renderPointings","AudioMuting","logoEnabled","logoDisabled","toggleAudioMuting","getAudioTracks","enabled","CameraMuting","toggleCameraMuting","getVideoTracks","MapMuting","CameraSwitching","switchCamera","replaceStream","ToolItem","children","ToolList","Room","App","Fragment","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.27200609.chunk.js","sourcesContent":["let currentIndex = -1;\nlet currentStream: any = null;\nasync function getDevices() {\n  const devices = await navigator.mediaDevices.enumerateDevices();\n  return devices.filter(device => device.kind === \"videoinput\");\n}\nexport async function nextVideoStream() {\n  if (currentStream) {\n    currentStream.getTracks().forEach((track: any) => {\n      track.stop();\n    });\n  }\n  const devices = await getDevices();\n  const nextIndex = currentIndex === devices.length - 1 ? 0 : currentIndex + 1;\n  const nextDevice = devices[nextIndex];\n  const deviceId = { exact: nextDevice.deviceId };\n  currentIndex = nextIndex;\n  currentStream = await navigator.mediaDevices.getUserMedia({\n    audio: true,\n    video: { deviceId },\n  });\n  return currentStream;\n}\n","import { AnyAction } from \"redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n\nimport Peer from \"skyway-js\";\nimport { actionCreatorFactory } from \"../node_modules/typescript-fsa\";\n\nimport { nextVideoStream } from \"./lib/video\";\nimport { TStore } from \"./store\";\n\nconst actionCreator = actionCreatorFactory();\n\nexport const AddPeerAction = actionCreator<{\n  peerId: string;\n  stream: any;\n}>(\"ADD_PEER\");\nexport const AddPointingAction = actionCreator.async<\n  { peerId: string; x: number; y: number },\n  { peerId: string; x: number; y: number },\n  { error: any }\n>(\"ADD_POINTING\");\nexport const ParticipateAction = actionCreator.async<\n  {},\n  {\n    localPeer: Peer;\n    localStream: MediaStream;\n    room: any;\n  },\n  { error: any }\n>(\"PARTICIPATE\");\nexport const RemovePeerAction = actionCreator<{ peerId: string }>(\n  \"REMOVE_PEER\"\n);\nexport const RemovePointingAction = actionCreator<{ peerId: string }>(\n  \"REMOVE_POINTING\"\n);\nexport const SelectPeerAction = actionCreator.async<{}, {}, { error: any }>(\n  \"SELECT_PEER\"\n);\nexport const SetPointintAcrion = actionCreator.async<{}, {}, { error: any }>(\n  \"SET_POINTING\"\n);\nexport const SetTransformAcrion = actionCreator.async<{}, {}, { error: any }>(\n  \"SET_TRANSFORM\"\n);\nexport const SwitchCameraAction = actionCreator.async<\n  {},\n  { localStream: MediaStream },\n  { error: any }\n>(\"SWITCH_CAMERA\");\nexport const ToggleAudioMutingAction = actionCreator.async<\n  {},\n  { isEnabled: boolean },\n  { error: any }\n>(\"TOGGLE_AUDIO_MUTING\");\nexport const ToggleCameraMutingAction = actionCreator.async<\n  {},\n  { isEnabled: boolean },\n  { error: any }\n>(\"TOGGLE_CAMERA_MUTING\");\nexport const ToggleMapMutingAction = actionCreator.async<\n  {},\n  { isEnabled: boolean },\n  { error: any }\n>(\"TOGGLE_MAP_MUTING\");\nexport const InitializeMapAction = actionCreator.async<\n  {},\n  {\n    key: string;\n    lat: number;\n    lng: number;\n    defaultZoom: number;\n  },\n  { error: any }\n>(\"INITIALIZE_MAP\");\nexport const OnMapLocationChangedAction = actionCreator<{\n  lat: number;\n  lng: number;\n}>(\"ON_MAP_LOCATION_CHANGED\");\nexport const OnPeerSelectedAction = actionCreator<{\n  peerId: string;\n}>(\"ON_PEER_SELECTED\");\nexport const OnTransformChangedAction = actionCreator<{\n  x: number;\n  y: number;\n  scale: number;\n}>(\"ON_TRANSFORM_CHANGED\");\n\nconst pointingTimerMap = new Map();\n\nexport function participate(\n  key: string,\n  network: \"mesh\" | \"sfu\",\n  roomId: string\n) {\n  return async (\n    dispatch: ThunkDispatch<TStore, void, AnyAction>,\n    getState: () => TStore\n  ) => {\n    const params = { key, network, roomId };\n    try {\n      dispatch(ParticipateAction.started(params));\n\n      const localStream = await nextVideoStream();\n      const localPeer: Peer = await new Promise(r => {\n        const peer = new Peer({ key: key });\n        peer.on(\"open\", () => r(peer));\n      });\n\n      const room = localPeer.joinRoom(roomId, {\n        mode: network,\n        stream: localStream,\n      });\n\n      room.on(\"peerLeave\", peerId => dispatch(RemovePeerAction({ peerId })));\n      room.on(\"stream\", stream => onStream(dispatch, getState(), stream));\n      room.on(\"data\", ({ data }) => onData(dispatch, data));\n\n      const result = {\n        localPeer,\n        localStream,\n        room,\n      };\n\n      dispatch(ParticipateAction.done({ result, params }));\n    } catch (error) {\n      dispatch(ParticipateAction.failed({ error, params }));\n    }\n  };\n}\n\nfunction addPointing(peerId: string, x: number, y: number) {\n  return async (dispatch: ThunkDispatch<TStore, void, AnyAction>) => {\n    const params = { peerId, x, y };\n\n    try {\n      dispatch(AddPointingAction.started(params));\n\n      clearTimeout(pointingTimerMap.get(peerId));\n      const timerId = setTimeout(\n        () => dispatch(RemovePointingAction({ peerId })),\n        4000\n      );\n      pointingTimerMap.set(peerId, timerId);\n\n      dispatch(AddPointingAction.done({ result: params, params }));\n    } catch (error) {\n      dispatch(AddPointingAction.failed({ error, params }));\n    }\n  };\n}\n\nexport function selectPeer(peerId: string) {\n  return async (\n    dispatch: ThunkDispatch<TStore, void, AnyAction>,\n    getState: () => TStore\n  ) => {\n    const params = {};\n\n    try {\n      dispatch(SelectPeerAction.started(params));\n\n      const room = getState()?.state.room;\n      if (room) {\n        room.send({ type: \"peer-selected\", peerId });\n        // As the room.send does not send to the local peer, update manually.\n        dispatch(OnPeerSelectedAction({ peerId }));\n      }\n\n      dispatch(SelectPeerAction.done({ result: {}, params }));\n    } catch (error) {\n      dispatch(SelectPeerAction.failed({ error, params }));\n    }\n  };\n}\n\nexport function setPointing(x: number, y: number) {\n  return async (\n    dispatch: ThunkDispatch<TStore, void, AnyAction>,\n    getState: () => TStore\n  ) => {\n    const params = {};\n\n    try {\n      dispatch(SetPointintAcrion.started(params));\n\n      const state = getState()?.state;\n\n      const peerId = state.localPeer?.id;\n\n      if (peerId) {\n        state.room?.send({ type: \"pointing-added\", peerId, x, y });\n        // As the room.send does not send to the local peer, update manually.\n        dispatch(addPointing(peerId, x, y));\n      }\n\n      dispatch(SetPointintAcrion.done({ result: {}, params }));\n    } catch (error) {\n      dispatch(SetPointintAcrion.failed({ error, params }));\n    }\n  };\n}\n\nexport function setTransform(x: number, y: number, scale: number) {\n  return async (\n    dispatch: ThunkDispatch<TStore, void, AnyAction>,\n    getState: () => TStore\n  ) => {\n    const params = {};\n\n    try {\n      dispatch(SetTransformAcrion.started(params));\n\n      const state = getState()?.state;\n      state.room?.send({ type: \"transform-changed\", x, y, scale });\n\n      dispatch(SetTransformAcrion.done({ result: {}, params }));\n    } catch (error) {\n      dispatch(SetTransformAcrion.failed({ error, params }));\n    }\n  };\n}\n\nexport function switchCamera() {\n  return async (\n    dispatch: ThunkDispatch<TStore, void, AnyAction>,\n    getState: () => TStore\n  ) => {\n    const params = {};\n\n    try {\n      dispatch(SwitchCameraAction.started(params));\n\n      const state = getState()?.state;\n\n      // Close previouse stream.\n      for (const track of state?.localStream?.getTracks() || []) {\n        track.enabled = false;\n      }\n\n      const localStream = await nextVideoStream();\n\n      // parameter of replaceStream is defined as MediaSource, but localStream is MediaStream.\n      // I don't know why..\n      (state?.room as any)?.replaceStream(localStream);\n\n      const result = { localStream };\n\n      dispatch(SwitchCameraAction.done({ result, params }));\n    } catch (error) {\n      dispatch(SwitchCameraAction.failed({ error, params }));\n    }\n  };\n}\n\nexport function toggleAudioMuting() {\n  return async (\n    dispatch: ThunkDispatch<TStore, void, AnyAction>,\n    getState: () => TStore\n  ) => {\n    const params = {};\n\n    try {\n      dispatch(ToggleAudioMutingAction.started(params));\n\n      const state = getState()?.state;\n      const isEnabled = !state?.isAudioEnabled;\n      const localStream = state?.localStream;\n\n      for (const track of localStream?.getAudioTracks() || []) {\n        track.enabled = isEnabled;\n      }\n\n      const result = { isEnabled };\n\n      dispatch(ToggleAudioMutingAction.done({ result, params }));\n    } catch (error) {\n      dispatch(ToggleAudioMutingAction.failed({ error, params }));\n    }\n  };\n}\n\nexport function toggleCameraMuting() {\n  return async (\n    dispatch: ThunkDispatch<TStore, void, AnyAction>,\n    getState: () => TStore\n  ) => {\n    const params = {};\n\n    try {\n      dispatch(ToggleCameraMutingAction.started(params));\n\n      const state = getState()?.state;\n      const isEnabled = !state?.isCameraEnabled;\n      const localStream = state?.localStream;\n\n      for (const track of localStream?.getVideoTracks() || []) {\n        track.enabled = isEnabled;\n      }\n\n      const result = { isEnabled };\n\n      dispatch(ToggleCameraMutingAction.done({ result, params }));\n    } catch (error) {\n      dispatch(ToggleCameraMutingAction.failed({ error, params }));\n    }\n  };\n}\nexport function toggleMapMuting() {\n  return async (\n    dispatch: ThunkDispatch<TStore, void, AnyAction>,\n    getState: () => TStore\n  ) => {\n    const params = {};\n\n    try {\n      dispatch(ToggleMapMutingAction.started(params));\n\n      const state = getState()?.state;\n      const isEnabled = !state?.isMapEnabled;\n\n      const result = { isEnabled };\n\n      dispatch(ToggleMapMutingAction.done({ result, params }));\n    } catch (error) {\n      dispatch(ToggleMapMutingAction.failed({ error, params }));\n    }\n  };\n}\n\nexport function InitializeMap(key: string) {\n  return async (\n    dispatch: ThunkDispatch<TStore, void, AnyAction>,\n    getState: () => TStore\n  ) => {\n    const params = {};\n\n    try {\n      dispatch(InitializeMapAction.started(params));\n      const defaultZoom = 12;\n      const { lat, lng } = await new Promise(resolve =>\n        navigator.geolocation.getCurrentPosition(pos => {\n          resolve({ lat: pos.coords.latitude, lng: pos.coords.longitude });\n        })\n      );\n      navigator.geolocation.watchPosition(pos => {\n        const state = getState()?.state;\n\n        if (!state) {\n          return;\n        }\n\n        const presenter = state.presenter?.peerId;\n        const localpeer = state.localPeer?.id;\n        if (presenter === localpeer) {\n          state.room?.send({\n            type: \"location-changed\",\n            lat: pos.coords.latitude,\n            lng: pos.coords.longitude,\n          });\n          dispatch(\n            OnMapLocationChangedAction({\n              lat: pos.coords.latitude,\n              lng: pos.coords.longitude,\n            })\n          );\n        }\n      });\n      const result = { key, lat, lng, defaultZoom };\n      dispatch(InitializeMapAction.done({ result, params }));\n    } catch (error) {\n      dispatch(InitializeMapAction.failed({ error, params }));\n    }\n  };\n}\n\nfunction onStream(\n  dispatch: ThunkDispatch<TStore, void, AnyAction>,\n  store: TStore,\n  stream: any\n) {\n  dispatch(AddPeerAction({ peerId: stream.peerId, stream }));\n  // Tell who is a presenter now, to peer joined newly.\n  if (store.state.presenter) {\n    store.state.room?.send({\n      type: \"peer-selected\",\n      peerId: store.state.presenter.peerId,\n    });\n  }\n}\n\nfunction onData(dispatch: ThunkDispatch<TStore, void, AnyAction>, data: any) {\n  switch (data.type) {\n    case \"location-changed\": {\n      dispatch(OnMapLocationChangedAction({ lat: data.lat, lng: data.lng }));\n      break;\n    }\n    case \"peer-selected\": {\n      dispatch(OnPeerSelectedAction({ peerId: data.peerId }));\n      break;\n    }\n    case \"pointing-added\": {\n      dispatch(addPointing(data.peerId, data.x, data.y));\n      break;\n    }\n    case \"transform-changed\": {\n      dispatch(\n        OnTransformChangedAction({ x: data.x, y: data.y, scale: data.scale })\n      );\n      break;\n    }\n  }\n}\n","import { reducerWithInitialState } from \"typescript-fsa-reducers\";\n\nimport {\n  AddPeerAction,\n  AddPointingAction,\n  ParticipateAction,\n  RemovePeerAction,\n  RemovePointingAction,\n  SwitchCameraAction,\n  ToggleAudioMutingAction,\n  ToggleCameraMutingAction,\n  ToggleMapMutingAction,\n  OnMapLocationChangedAction,\n  OnPeerSelectedAction,\n  OnTransformChangedAction,\n  InitializeMapAction,\n} from \"./actions\";\nimport { Map, Member, Pointing, Transform } from \"./types\";\n\nexport interface IState {\n  audiences: Member[];\n  isAudioEnabled: boolean;\n  isCameraEnabled: boolean;\n  isMapEnabled: boolean;\n  localPeer?: Peer;\n  localStream?: MediaStream;\n  room?: SFURoom | MeshRoom;\n  pointings: Pointing[];\n  map?: Map;\n  presenter?: Member;\n  transform: Transform;\n  // Don't use this. The reason why we need this variable is because the `peer-selected`\n  // event and AddPeerAction timing after joining the room is racing.\n  _selectedPeerId?: string;\n}\n\nconst initialState: IState = {\n  audiences: [],\n  isAudioEnabled: true,\n  isCameraEnabled: true,\n  isMapEnabled: true,\n  pointings: [],\n  transform: { x: 0, y: 0, scale: 1 },\n};\n\nexport const reducer = reducerWithInitialState(initialState)\n  .case(AddPeerAction, (state, { peerId, stream }) => {\n    const audience = { peerId, stream };\n    const audiences = [...state.audiences, audience];\n\n    // As the presenter peer joined after firing `peer-selected` event, set as a presenter.\n    const presenter =\n      state._selectedPeerId === peerId ? audience : state.presenter;\n    const transform =\n      presenter === state.presenter ? state.transform : initialState.transform;\n\n    return Object.assign({}, state, { audiences, presenter, transform });\n  })\n  .case(AddPointingAction.done, (state, { result }) => {\n    const { peerId, x, y } = result;\n    const pointings = state.pointings.filter(p => p.audience.peerId !== peerId);\n    const audience = state.audiences.find(a => a.peerId === peerId);\n\n    return Object.assign({}, state, {\n      pointings: [...pointings, { audience, x, y }],\n    });\n  })\n  .case(ParticipateAction.done, (state, { result }) => {\n    const { localPeer, localStream, room } = result;\n\n    const audience = {\n      peerId: localPeer.id,\n      stream: localStream,\n    };\n    const audiences = [audience];\n\n    return Object.assign({}, state, {\n      audiences,\n      localPeer,\n      localStream,\n      room,\n    });\n  })\n  .case(RemovePeerAction, (state, { peerId }) => {\n    const audiences = state.audiences.filter(a => a.peerId !== peerId);\n    const presenter =\n      state.presenter?.peerId === peerId ? null : state.presenter;\n\n    return Object.assign({}, state, { audiences, presenter });\n  })\n  .case(RemovePointingAction, (state, { peerId }) => {\n    const pointings = state.pointings.filter(p => p.audience.peerId !== peerId);\n\n    return Object.assign({}, state, { pointings });\n  })\n  .case(SwitchCameraAction.done, (state, { result }) => {\n    const { localStream } = result;\n    const peerId = state.localPeer?.id;\n\n    const audiences = state.audiences.map(a =>\n      a.peerId === peerId ? { peerId, stream: localStream } : a\n    );\n\n    const presenter =\n      state.presenter?.peerId === peerId\n        ? { peerId, stream: localStream }\n        : state.presenter;\n\n    return Object.assign({}, state, { audiences, localStream, presenter });\n  })\n  .case(ToggleAudioMutingAction.done, (state, { result }) => {\n    const { isEnabled } = result;\n\n    return Object.assign({}, state, { isAudioEnabled: isEnabled });\n  })\n  .case(ToggleCameraMutingAction.done, (state, { result }) => {\n    const { isEnabled } = result;\n\n    return Object.assign({}, state, { isCameraEnabled: isEnabled });\n  })\n  .case(ToggleMapMutingAction.done, (state, { result }) => {\n    const { isEnabled } = result;\n\n    return Object.assign({}, state, { isMapEnabled: isEnabled });\n  })\n  .case(OnMapLocationChangedAction, (state, { lat, lng }) => {\n    return Object.assign({}, state, {\n      map: Object.assign({}, state.map, { lat, lng }),\n    });\n  })\n  .case(OnPeerSelectedAction, (state, { peerId }) => {\n    const presenter = state.audiences.find(a => a.peerId === peerId);\n\n    return Object.assign({}, state, {\n      presenter,\n      transform: initialState.transform,\n      _selectedPeerId: peerId,\n    });\n  })\n  .case(InitializeMapAction.done, (state, { result }) => {\n    const { key, lat, lng, defaultZoom } = result;\n    return Object.assign({}, state, { map: { key, lat, lng, defaultZoom } });\n  })\n  .case(OnTransformChangedAction, (state, { x, y, scale }) => {\n    return Object.assign({}, state, { transform: { x, y, scale } });\n  });\n","import { combineReducers, createStore, applyMiddleware } from \"redux\";\nimport thunk from \"redux-thunk\";\nimport { reducer, IState } from \"./reducer\";\n\nexport type TStore = {\n  state: IState;\n};\n\nexport const store = createStore(\n  combineReducers<TStore>({\n    state: reducer,\n  }),\n  {},\n  applyMiddleware(thunk)\n);\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\nimport { AnyAction } from \"redux\";\n\nimport { TStore } from \"../store\";\nimport { participate } from \"../actions\";\nimport { InitializeMap } from \"../actions\";\n\nimport \"./Participation.css\";\n\ninterface IProps {\n  participate: any;\n  InitializeMap: any;\n}\n\ninterface IState {\n  key: string | null;\n  mapkey: string | null;\n  network: string | null;\n  room: string | null;\n  error: string | null;\n  isParticipating?: boolean;\n}\n\nclass Participation extends React.PureComponent<IProps, IState> {\n  constructor(props: IProps) {\n    super(props);\n    this._onClick = this._onClick.bind(this);\n\n    const url = new URL(document.URL);\n    const key = url.searchParams.get(\"key\");\n    const mapkey = url.searchParams.get(\"mapkey\");\n    const network = url.searchParams.get(\"network\");\n    const room = url.searchParams.get(\"room\");\n\n    let error = null;\n    if (!key || !network || !room) {\n      error = \"No specific key, network or room\";\n    } else if (network !== \"sfu\" && network !== \"mesh\") {\n      error = \"Network should be 'sfu' or 'mesh'\";\n    } else if (!mapkey) {\n      error = \"No specific GoogleMapAPIkey\";\n    }\n\n    this.state = { key, mapkey, network, room, error };\n  }\n\n  _onClick() {\n    const { participate, InitializeMap } = this.props;\n    const { key, mapkey, network, room } = this.state;\n    this.setState({ isParticipating: true });\n    participate(key, network, room);\n    InitializeMap(mapkey);\n  }\n\n  render() {\n    const { room, error, isParticipating } = this.state;\n\n    return (\n      <section className=\"participation\">\n        {error ? (\n          <label className=\"participation__error\">{error}</label>\n        ) : (\n          <button\n            className=\"participation__button\"\n            onClick={this._onClick}\n            disabled={isParticipating}\n          >\n            <label>participate to </label>\n            <label className=\"participation__room\">{room}</label>\n          </button>\n        )}\n      </section>\n    );\n  }\n}\n\nconst mapDispatchToProps = (\n  dispatch: ThunkDispatch<TStore, void, AnyAction>\n) => ({\n  participate: (key: string, network: \"mesh\" | \"sfu\", room: string) => {\n    dispatch(participate(key, network, room));\n  },\n  InitializeMap: (mapkey: string) => {\n    dispatch(InitializeMap(mapkey));\n  },\n});\n\nexport default connect(null, mapDispatchToProps)(Participation);\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\nimport { AnyAction } from \"redux\";\n\nimport { TStore } from \"../store\";\nimport { selectPeer } from \"../actions\";\nimport { Member } from \"../types\";\n\nimport \"./AudienceItem.css\";\n\ninterface IProps {\n  audience: Member;\n  isMuted: boolean;\n  isSelected: boolean;\n  selectPeer: any;\n}\n\nclass AudienceItem extends React.PureComponent<IProps> {\n  // As video.playsInline is not defined in HTMLVideoElement, add \"any\" as well.\n  private _videoRef = React.createRef<HTMLVideoElement | any>();\n\n  constructor(props: IProps) {\n    super(props);\n\n    this._onClick = this._onClick.bind(this);\n  }\n\n  _onClick() {\n    const { audience, selectPeer } = this.props;\n    selectPeer(audience.peerId);\n  }\n\n  _updateVideo() {\n    const video = this._videoRef.current;\n    if (!video) {\n      return;\n    }\n\n    const { audience } = this.props;\n    video.srcObject = audience.stream;\n    video.playsInline = true;\n    video.play();\n  }\n\n  componentDidMount() {\n    this._updateVideo();\n  }\n\n  componentDidUpdate() {\n    this._updateVideo();\n  }\n\n  render() {\n    const { isMuted, isSelected } = this.props;\n\n    return (\n      <li\n        className={\n          \"audience-item \" + (isSelected ? \"audience-item--selected\" : \"\")\n        }\n        onClick={this._onClick}\n      >\n        <video\n          className=\"audience-item__video\"\n          muted={isMuted}\n          ref={this._videoRef}\n        />\n      </li>\n    );\n  }\n}\n\nconst mapDispatchToProps = (\n  dispatch: ThunkDispatch<TStore, void, AnyAction>\n) => ({\n  selectPeer: (peerId: string) => {\n    dispatch(selectPeer(peerId));\n  },\n});\n\nexport default connect(null, mapDispatchToProps)(AudienceItem);\n","import React from \"react\";\nimport { connect } from \"react-redux\";\n\nimport { TStore } from \"../store\";\nimport { Member } from \"../types\";\n\nimport AudienceItem from \"./AudienceItem\";\n\nimport \"./AudienceList.css\";\n\ninterface IProps {\n  audiences: Member[];\n  localPeer?: Peer;\n  presenter?: Member;\n}\n\nclass AudienceList extends React.PureComponent<IProps> {\n  render() {\n    const { audiences, localPeer, presenter } = this.props;\n\n    return (\n      <ul className=\"audience-list\">\n        {audiences.map(audience => (\n          <AudienceItem\n            key={audience.peerId}\n            audience={audience}\n            isMuted={audience.peerId === localPeer?.id}\n            isSelected={audience.peerId === presenter?.peerId}\n          />\n        ))}\n      </ul>\n    );\n  }\n}\n\nconst mapStateToProps = (store: TStore) => {\n  return {\n    audiences: store.state.audiences,\n    localPeer: store.state.localPeer,\n    presenter: store.state.presenter,\n  };\n};\n\nexport default connect(mapStateToProps)(AudienceList);\n","import React from \"react\";\nimport GoogleMapReact from \"google-map-react\";\nimport { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\nimport { AnyAction } from \"redux\";\n\nimport { TStore } from \"../store\";\nimport { toggleMapMuting } from \"../actions\";\nimport { InitializeMap } from \"../actions\";\nimport { Map } from \"../types\";\n\nimport pinImage from \"./pin_leg.png\";\nimport \"./MapPanel.css\";\n\ninterface IProps {\n  map?: Map;\n  isMapEnabled: boolean;\n}\nconst AnyReactComponent = ({ pinImage }: any) => {\n  return <img src={pinImage} alt=\"current position\" />;\n};\nclass MapPanel extends React.PureComponent<IProps> {\n  render() {\n    const { isMapEnabled, map } = this.props;\n    const className = isMapEnabled ? \"mappanel\" : \"mappanel--disabled\";\n\n    if (!map) {\n      return null;\n    }\n\n    return (\n      <div className={className}>\n        <GoogleMapReact\n          bootstrapURLKeys={{\n            key: map.key,\n          }}\n          center={{\n            lat: map.lat,\n            lng: map.lng,\n          }}\n          defaultZoom={map.defaultZoom}\n        >\n          <AnyReactComponent lat={map.lat} lng={map.lng} pinImage={pinImage} />\n        </GoogleMapReact>\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = (store: TStore) => {\n  return {\n    isMapEnabled: store.state.isMapEnabled,\n    map: store.state.map,\n  };\n};\n\nconst mapDispatchToProps = (\n  dispatch: ThunkDispatch<TStore, void, AnyAction>\n) => ({\n  InitializeMap: (key: string) => {\n    dispatch(InitializeMap(key));\n  },\n  toggleMapMuting: () => {\n    dispatch(toggleMapMuting());\n  },\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MapPanel);\n","export default \"data:image/png;base64,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\"","export default __webpack_public_path__ + \"static/media/Pointing.404d2612.png\";","import React from \"react\";\n\nimport logo from \"./Pointing.png\";\nimport \"./Pointing.css\";\nimport { Member } from \"../types\";\n\ninterface IProps {\n  audience: Member;\n  x: number;\n  y: number;\n  radian: number;\n}\n\nclass Pointing extends React.PureComponent<IProps> {\n  // As video.playsInline is not defined in HTMLVideoElement, add \"any\" as well.\n  private _videoRef = React.createRef<HTMLVideoElement | any>();\n\n  _updateVideo() {\n    const video = this._videoRef.current;\n    if (!video) {\n      return;\n    }\n\n    const { audience } = this.props;\n    video.srcObject = audience.stream;\n    video.playsInline = true;\n    video.play();\n  }\n\n  componentDidMount() {\n    this._updateVideo();\n  }\n\n  componentDidUpdate() {\n    this._updateVideo();\n  }\n\n  render() {\n    const { audience, x, y, radian } = this.props;\n\n    const angle = (radian * 180) / Math.PI;\n    const scale = angle > 0 ? -1 : 1;\n    const styles = {\n      left: `${x}px`,\n      top: `${y}px`,\n      transform: `translate(-60%, 0%) rotate(${angle}deg) scale(${scale}, 1)`,\n      transformOrigin: \"60% 0%\",\n    };\n\n    const videoStyles = {\n      transform: `scale(${angle > 0 ? -1 : 1}, 1) rotate(${-angle}deg)`,\n      transformOrigin: \"50%\",\n    };\n\n    return (\n      <mark className=\"pointing\" style={styles}>\n        <img className=\"pointing__image\" src={logo} alt={audience.peerId} />\n        <div className=\"pointing__audience\">\n          <video\n            className=\"pointing__audience__video\"\n            style={videoStyles}\n            muted={true}\n            ref={this._videoRef}\n          ></video>\n        </div>\n      </mark>\n    );\n  }\n}\n\nexport default Pointing;\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\nimport { AnyAction } from \"redux\";\n\nimport { TransformWrapper, TransformComponent } from \"react-zoom-pan-pinch\";\n\nimport { TStore } from \"../store\";\nimport { Member, Pointing, Transform } from \"../types\";\nimport { setPointing, setTransform } from \"../actions\";\nimport PointingComponent from \"./Pointing\";\n\nimport \"./Presenter.css\";\n\ninterface IProps {\n  localPeer?: Peer;\n  pointings: Pointing[];\n  presenter?: Member;\n  transform: Transform;\n  setPointing: any;\n  setTransform: any;\n}\n\nclass Presenter extends React.PureComponent<IProps> {\n  // As video.playsInline is not defined in HTMLVideoElement, add \"any\" as well.\n  private _videoRef = React.createRef<HTMLVideoElement | any>();\n\n  private _panStopTimer = 0;\n\n  constructor(props: IProps) {\n    super(props);\n\n    this._onClick = this._onClick.bind(this);\n    this._onPanningStop = this._onPanningStop.bind(this);\n    this._onZoomChange = this._onZoomChange.bind(this);\n  }\n\n  _amIPresenter() {\n    const { localPeer, presenter } = this.props;\n\n    if (!localPeer || !presenter) {\n      return false;\n    }\n\n    return localPeer.id === presenter.peerId;\n  }\n\n  _getVideoArea() {\n    const video = this._videoRef.current;\n    return video?.closest(\".react-transform-component\");\n  }\n\n  _isMobile() {\n    return /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(\n      navigator.userAgent.toLowerCase()\n    );\n  }\n\n  _onClick(e: any) {\n    const { target, layerX, layerY } = e;\n    const { clientWidth, clientHeight } = target;\n    const x = layerX / clientWidth;\n    const y = layerY / clientHeight;\n    this.props.setPointing(x, y);\n  }\n\n  /**\n   * NOTE: This function is for following issue.\n   * After fixing following issue, need to address for it.\n   * https://github.com/prc5/react-zoom-pan-pinch/issues/89\n   */\n  _onPanningStop() {\n    this._panStopTimer = window.setTimeout(() => {\n      const video = this._videoRef.current;\n      if (!video) {\n        return;\n      }\n\n      const transformElement = video.closest(\".react-transform-element\");\n      const transform = transformElement.style.transform.match(\n        /translate\\((.*)\\) scale\\((.*)\\)/\n      );\n      const translate = transform[1];\n      const translateMatch = translate.match(/(.*), (.*)/);\n      const positionX = parseFloat(\n        translateMatch ? translateMatch[1] : translate\n      );\n      const positionY = parseFloat(\n        translateMatch && translateMatch.length === 3 ? translateMatch[2] : 0\n      );\n      const scale = parseFloat(transform[2]);\n      this._onZoomChange({ positionX, positionY, scale });\n    }, 500);\n  }\n\n  _onZoomChange(e: any) {\n    window.clearTimeout(this._panStopTimer);\n\n    const area = this._getVideoArea();\n    const { positionX, positionY, scale } = e;\n    const { clientWidth, clientHeight } = area;\n    const x = positionX / clientWidth;\n    const y = positionY / clientHeight;\n    this.props.setTransform(x, y, scale);\n  }\n\n  _renderPointings() {\n    const area = this._getVideoArea();\n    if (!area) {\n      return null;\n    }\n\n    const { pointings } = this.props;\n    return pointings.map(p => {\n      const audience = p.audience;\n      const x = area.offsetLeft + area.clientWidth * p.x;\n      const y = area.offsetTop + area.clientHeight * p.y;\n      const radian = Math.atan2(p.x - 0.5, -(p.y - 0.5));\n\n      return (\n        <PointingComponent\n          key={audience.peerId}\n          audience={audience}\n          x={x}\n          y={y}\n          radian={radian}\n        />\n      );\n    });\n  }\n\n  componentDidMount() {\n    const area = this._getVideoArea();\n    if (!area) {\n      return null;\n    }\n\n    // We can't get layerX/layerY from React mouse event.\n    area.addEventListener(\"click\", this._onClick);\n  }\n\n  componentDidUpdate(prevProps: IProps) {\n    const video = this._videoRef.current;\n    if (!video) {\n      return;\n    }\n\n    const { presenter } = this.props;\n    if (prevProps.presenter === presenter) {\n      return;\n    }\n\n    if (presenter) {\n      video.muted = this._amIPresenter();\n      video.srcObject = presenter.stream;\n      video.playsInline = true;\n      video.play();\n    } else {\n      video.srcObject = null;\n    }\n  }\n\n  render() {\n    const area = this._getVideoArea();\n\n    const settings =\n      this._amIPresenter() && this._isMobile()\n        ? {\n            onPanningStop: this._onPanningStop,\n            onZoomChange: this._onZoomChange,\n            pan: {\n              disabled: false,\n            },\n          }\n        : {\n            positionX: area?.clientWidth * this.props.transform.x,\n            positionY: area?.clientHeight * this.props.transform.y,\n            scale: this.props.transform.scale,\n            pan: {\n              disabled: true,\n            },\n          };\n\n    return (\n      <section className=\"presenter\">\n        <TransformWrapper\n          onPanning={settings.onZoomChange}\n          onPanningStop={settings.onPanningStop}\n          onZoomChange={settings.onZoomChange}\n          positionX={settings.positionX}\n          positionY={settings.positionY}\n          scale={settings.scale}\n          pan={settings.pan}\n          doubleClick={{ disabled: true }}\n        >\n          <TransformComponent>\n            <video className=\"presenter__video\" ref={this._videoRef}></video>\n          </TransformComponent>\n        </TransformWrapper>\n        {this._renderPointings()}\n      </section>\n    );\n  }\n}\n\nconst mapStateToProps = (store: TStore) => {\n  return {\n    localPeer: store.state.localPeer,\n    pointings: store.state.pointings,\n    presenter: store.state.presenter,\n    transform: store.state.transform,\n  };\n};\n\nconst mapDispatchToProps = (\n  dispatch: ThunkDispatch<TStore, void, AnyAction>\n) => ({\n  setPointing: (x: number, y: number) => {\n    dispatch(setPointing(x, y));\n  },\n  setTransform: (x: number, y: number, scale: number) => {\n    dispatch(setTransform(x, y, scale));\n  },\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Presenter);\n","export default __webpack_public_path__ + \"static/media/AudioMuting.1652404d.svg\";","export default __webpack_public_path__ + \"static/media/AudioMutingDisabled.df4814d2.svg\";","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\nimport { AnyAction } from \"redux\";\n\nimport { TStore } from \"../store\";\nimport { toggleAudioMuting } from \"../actions\";\n\nimport logoEnabled from \"./AudioMuting.svg\";\nimport logoDisabled from \"./AudioMutingDisabled.svg\";\nimport \"./AudioMuting.css\";\n\ninterface IProps {\n  isAudioEnabled: boolean;\n  toggleAudioMuting: any;\n}\n\nclass AudioMuting extends React.PureComponent<IProps> {\n  render() {\n    const { isAudioEnabled } = this.props;\n    const logo = isAudioEnabled ? logoEnabled : logoDisabled;\n\n    return (\n      <button onClick={this.props.toggleAudioMuting} className=\"audio-muting\">\n        <img\n          src={logo}\n          alt=\"mute/unmute audio\"\n          className=\"audio-muting__image\"\n        />\n      </button>\n    );\n  }\n}\n\nconst mapStateToProps = (store: TStore) => {\n  return {\n    isAudioEnabled: store.state.isAudioEnabled,\n  };\n};\n\nconst mapDispatchToProps = (\n  dispatch: ThunkDispatch<TStore, void, AnyAction>\n) => ({\n  toggleAudioMuting: () => {\n    dispatch(toggleAudioMuting());\n  },\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(AudioMuting);\n","export default __webpack_public_path__ + \"static/media/CameraMuting.e9966563.svg\";","export default __webpack_public_path__ + \"static/media/CameraMutingDisabled.122df4d4.svg\";","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\nimport { AnyAction } from \"redux\";\n\nimport { TStore } from \"../store\";\nimport { toggleCameraMuting } from \"../actions\";\n\nimport logoEnabled from \"./CameraMuting.svg\";\nimport logoDisabled from \"./CameraMutingDisabled.svg\";\nimport \"./CameraMuting.css\";\n\ninterface IProps {\n  isCameraEnabled: boolean;\n  toggleCameraMuting: any;\n}\n\nclass CameraMuting extends React.PureComponent<IProps> {\n  render() {\n    const { isCameraEnabled } = this.props;\n    const logo = isCameraEnabled ? logoEnabled : logoDisabled;\n\n    return (\n      <button onClick={this.props.toggleCameraMuting} className=\"camera-muting\">\n        <img\n          src={logo}\n          alt=\"mute/unmute camera\"\n          className=\"camera-muting__image\"\n        />\n      </button>\n    );\n  }\n}\n\nconst mapStateToProps = (store: TStore) => {\n  return {\n    isCameraEnabled: store.state.isCameraEnabled,\n  };\n};\n\nconst mapDispatchToProps = (\n  dispatch: ThunkDispatch<TStore, void, AnyAction>\n) => ({\n  toggleCameraMuting: () => {\n    dispatch(toggleCameraMuting());\n  },\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(CameraMuting);\n","export default __webpack_public_path__ + \"static/media/MapMuting.68798305.svg\";","export default __webpack_public_path__ + \"static/media/MapMutingDisabled.2c8147b6.svg\";","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\nimport { AnyAction } from \"redux\";\n\nimport { TStore } from \"../store\";\nimport { toggleMapMuting } from \"../actions\";\n\nimport logoEnabled from \"./MapMuting.svg\";\nimport logoDisabled from \"./MapMutingDisabled.svg\";\nimport \"./MapMuting.css\";\n\ninterface IProps {\n  isMapEnabled: boolean;\n  toggleMapMuting: any;\n}\n\nclass MapMuting extends React.PureComponent<IProps> {\n  render() {\n    const { isMapEnabled } = this.props;\n    const logo = isMapEnabled ? logoEnabled : logoDisabled;\n\n    return (\n      <button onClick={this.props.toggleMapMuting} className=\"map-muting\">\n        <img src={logo} alt=\"mute/unmute map\" className=\"map-muting__image\" />\n      </button>\n    );\n  }\n}\n\nconst mapStateToProps = (store: TStore) => {\n  return {\n    isMapEnabled: store.state.isMapEnabled,\n  };\n};\n\nconst mapDispatchToProps = (\n  dispatch: ThunkDispatch<TStore, void, AnyAction>\n) => ({\n  toggleMapMuting: () => {\n    dispatch(toggleMapMuting());\n  },\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MapMuting);\n","export default __webpack_public_path__ + \"static/media/CameraSwitching.626c7733.svg\";","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\nimport { AnyAction } from \"redux\";\n\nimport { TStore } from \"../store\";\nimport { switchCamera } from \"../actions\";\n\nimport logo from \"./CameraSwitching.svg\";\nimport \"./CameraSwitching.css\";\n\ninterface IProps {\n  switchCamera: any;\n}\n\nclass CameraSwitching extends React.PureComponent<IProps> {\n  render() {\n    return (\n      <button onClick={this.props.switchCamera} className=\"camera-switching\">\n        <img\n          src={logo}\n          alt=\"switch camera\"\n          className=\"camera-switching__image\"\n        />\n      </button>\n    );\n  }\n}\n\nconst mapDispatchToProps = (\n  dispatch: ThunkDispatch<TStore, void, AnyAction>\n) => ({\n  switchCamera: () => {\n    dispatch(switchCamera());\n  },\n});\n\nexport default connect(null, mapDispatchToProps)(CameraSwitching);\n","import React from \"react\";\n\nimport \"./ToolItem.css\";\n\ninterface IProps {\n  children: React.ReactNode;\n}\n\nclass ToolItem extends React.PureComponent<IProps> {\n  render() {\n    const { children } = this.props;\n\n    return <li className=\"tool-item\">{children}</li>;\n  }\n}\n\nexport default ToolItem;\n","import React from \"react\";\n\nimport AudioMuting from \"./AudioMuting\";\nimport CameraMuting from \"./CameraMuting\";\nimport MapMuting from \"./MapMuting\";\nimport CameraSwitching from \"./CameraSwitching\";\nimport ToolItem from \"./ToolItem\";\n\nimport \"./ToolList.css\";\n\nclass ToolList extends React.PureComponent {\n  render() {\n    return (\n      <ul className=\"tool-list\">\n        <ToolItem>\n          <CameraSwitching />\n        </ToolItem>\n        <ToolItem>\n          <MapMuting />\n        </ToolItem>\n        <ToolItem>\n          <CameraMuting />\n        </ToolItem>\n        <ToolItem>\n          <AudioMuting />\n        </ToolItem>\n      </ul>\n    );\n  }\n}\n\nexport default ToolList;\n","import React from \"react\";\n\nimport AudienceList from \"./AudienceList\";\nimport MapPanel from \"./MapPanel\";\nimport Presenter from \"./Presenter\";\nimport ToolList from \"./ToolList\";\n\nimport \"./Room.css\";\n\nclass Room extends React.PureComponent {\n  render() {\n    return (\n      <section className=\"room\">\n        <ToolList />\n        <Presenter />\n        <MapPanel />\n        <AudienceList />\n      </section>\n    );\n  }\n}\n\nexport default Room;\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { TStore } from \"../store\";\n\nimport Participation from \"./Participation\";\nimport Room from \"./Room\";\n\nimport \"./App.css\";\n\ninterface IProps {\n  room: any;\n}\n\nclass App extends React.PureComponent<IProps> {\n  render() {\n    return (\n      <React.Fragment>\n        {this.props.room ? <Room /> : <Participation />}\n      </React.Fragment>\n    );\n  }\n}\n\nconst mapStateToProps = (store: TStore) => {\n  return {\n    room: store.state.room,\n  };\n};\n\nexport default connect(mapStateToProps)(App);\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { Provider } from \"react-redux\";\n\nimport { store } from \"./store\";\n\nimport App from \"./components/App\";\nimport \"./index.css\";\n\nReactDOM.render(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}